<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPF Forskningsguide | Hitta r√§tt st√∂d</title>
    <style>
        /* --- CSS STYLING --- */
        :root {
            --cpf-blue: #005eb8; /* Region Stockholm Blue */
            --cpf-dark: #004485;
            --light-bg: #f5f7fa;
            --text-color: #333;
            --border-color: #ddd;
            --highlight-bg: #e8f4fd;
            --accent-color: #e3000f; /* Slight accent */
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--light-bg);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            background: white;
            width: 100%;
            max-width: 800px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            background-color: var(--cpf-blue);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 600;
        }

        header p {
            margin: 10px 0 0;
            opacity: 0.9;
            font-size: 1rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .privacy-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 10px;
        }

        /* Content Area */
        .content {
            padding: 30px;
        }

        .step {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            color: var(--cpf-blue);
            margin-top: 0;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 1.05rem;
        }

        select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            background-color: #fff;
        }

        select:focus {
            border-color: var(--cpf-blue);
            outline: none;
        }

        /* Radio Cards */
        .radio-group {
            display: grid;
            gap: 12px;
        }

        .radio-option {
            display: flex;
            align-items: flex-start;
            border: 1px solid var(--border-color);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }

        .radio-option:hover {
            background-color: #f8f9fa;
            border-color: #bbb;
        }

        .radio-option.selected {
            background-color: var(--highlight-bg);
            border-color: var(--cpf-blue);
            box-shadow: 0 0 0 1px var(--cpf-blue);
        }

        .radio-option input {
            margin-right: 15px;
            margin-top: 4px;
            transform: scale(1.3);
        }

        .radio-content strong {
            display: block;
            margin-bottom: 4px;
            font-size: 1rem;
        }

        .radio-content span {
            font-size: 0.9rem;
            color: #666;
        }

        /* Guidance Boxes (Result Cards) */
        .guidance-card {
            background: white;
            border: 1px solid #ddd;
            border-left: 5px solid var(--cpf-blue);
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
            display: none; /* Hidden by default */
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .guidance-card.visible {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .guidance-card h3 {
            margin-top: 0;
            color: var(--cpf-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon { font-size: 1.5rem; }

        .guidance-card a {
            color: var(--cpf-blue);
            font-weight: 600;
            text-decoration: none;
        }
        
        .guidance-card a:hover {
            text-decoration: underline;
        }

        /* Special Coordinator Card */
        .coordinator-card {
            background-color: #fff8e1; /* Light yellow/gold */
            border-left-color: #fbc02d;
        }
        
        .coord-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            display: block;
            margin: 10px 0;
        }

        /* Navigation */
        .actions {
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        .btn {
            padding: 12px 28px;
            border-radius: 6px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-secondary {
            background-color: #e9ecef;
            color: #495057;
        }

        .btn-primary {
            background-color: var(--cpf-blue);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--cpf-dark);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Reset Button */
        .reset-link {
            text-align: center;
            margin-top: 20px;
            display: block;
            color: #888;
            font-size: 0.9rem;
            cursor: pointer;
            text-decoration: underline;
        }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>CPF Forskningsguide</h1>
        <p>Ett sj√§lvhj√§lpsverktyg f√∂r dig som forskar inom psykiatrin i Stockholm.</p>
        <span class="privacy-badge">üîí Anonymt - Inga uppgifter sparas</span>
    </header>

    <div class="content">
        
        <!-- STEP 1: Identification (Klinik) -->
        <div id="step1" class="step active">
            <h2>Var arbetar du?</h2>
            <p>F√∂r att kunna h√§nvisa dig till r√§tt lokalt st√∂d beh√∂ver vi veta vilken klinik du tillh√∂r.</p>
            
            <div class="form-group">
                <label for="clinic">V√§lj din klinik:</label>
                <select id="clinic">
                    <option value="">-- V√§lj klinik i listan --</option>
                    <option value="BCS">Beroendecentrum Stockholm (BCS)</option>
                    <option value="BUP">Barn- och ungdomspsykiatri (BUP)</option>
                    <option value="NSP">Norra Stockholms psykiatri (NSP)</option>
                    <option value="PNV">Psykiatri Nordv√§st (PNV)</option>
                    <option value="PSV">Psykiatri Sydv√§st (PSV)</option>
                    <option value="PSS">Psykiatri S√∂dra Stockholm (PSS)</option>
                    <option value="SCA">Stockholms centrum f√∂r √§tst√∂rningar (SC√Ñ)</option>
                    <option value="Annat">Annat / Vet ej</option>
                </select>
            </div>

            <div class="actions" style="justify-content: flex-end;">
                <button class="btn btn-primary" onclick="goToStep(2)">N√§sta</button>
            </div>
        </div>

        <!-- STEP 2: Context (Huvudman) -->
        <div id="step2" class="step">
            <h2>Vem √§r huvudman?</h2>
            <p>Vem har det juridiska ansvaret f√∂r forskningsdata i ditt projekt?</p>
            
            <div class="radio-group">
                <label class="radio-option">
                    <input type="radio" name="huvudman" value="SLSO">
                    <div class="radio-content">
                        <strong>Region Stockholm (SLSO)</strong>
                        <span>Vanligt vid kliniska studier p√• patienter/journaldata.</span>
                    </div>
                </label>
                <label class="radio-option">
                    <input type="radio" name="huvudman" value="KI">
                    <div class="radio-content">
                        <strong>Karolinska Institutet (KI)</strong>
                        <span>Vanligt vid grundforskning eller registerstudier utanf√∂r v√•rden.</span>
                    </div>
                </label>
                <label class="radio-option">
                    <input type="radio" name="huvudman" value="Bada">
                    <div class="radio-content">
                        <strong>B√•da / Samverkan</strong>
                        <span>N√§r b√•da organisationerna √§r aktivt delaktiga.</span>
                    </div>
                </label>
            </div>

            <div class="actions">
                <button class="btn btn-secondary" onclick="goToStep(1)">Tillbaka</button>
                <button class="btn btn-primary" onclick="goToStep(3)">N√§sta</button>
            </div>
        </div>

        <!-- STEP 3: Needs (Kategori) -->
        <div id="step3" class="step">
            <h2>Vad beh√∂ver du hj√§lp med?</h2>
            
            <div class="radio-group">
                <label class="radio-option">
                    <input type="radio" name="category" value="Starta" onchange="showResult()">
                    <div class="radio-content">
                        <strong>Starta studie / Lokala tillst√•nd</strong>
                        <span>F√∂rankring, lokala avtal, etikans√∂kan, registrering.</span>
                    </div>
                </label>
                <label class="radio-option">
                    <input type="radio" name="category" value="Data" onchange="showResult()">
                    <div class="radio-content">
                        <strong>Datahantering & Lagring</strong>
                        <span>DMP, REDCap, ELN, servrar, transkribering.</span>
                    </div>
                </label>
                <label class="radio-option">
                    <input type="radio" name="category" value="Statistik" onchange="showResult()">
                    <div class="radio-content">
                        <strong>Metod & Statistik</strong>
                        <span>Studiedesign, powerber√§kning, statistikval.</span>
                    </div>
                </label>
                <label class="radio-option">
                    <input type="radio" name="category" value="Juridik" onchange="showResult()">
                    <div class="radio-content">
                        <strong>Juridik, Avtal & Registeruttag</strong>
                        <span>PuB-avtal, DTA, Menpr√∂vning, uttag fr√•n TakeCare.</span>
                    </div>
                </label>
                <label class="radio-option">
                    <input type="radio" name="category" value="Etik" onchange="showResult()">
                    <div class="radio-content">
                        <strong>Etikpr√∂vning</strong>
                        <span>F√∂rhandsgranskning av ans√∂kan.</span>
                    </div>
                </label>
            </div>

            <div class="actions">
                <button class="btn btn-secondary" onclick="goToStep(2)">Tillbaka</button>
                <!-- No Next button here, result shows automatically below -->
            </div>

            <!-- DYNAMIC RESULTS AREA -->
            <div id="results-area" style="margin-top: 40px; border-top: 2px dashed #ddd; padding-top: 30px; display: none;">
                <h2 style="border:none; color: #333;">Rekommenderad v√§g fram√•t:</h2>
                
                <!-- 1. COORDINATOR CARD (Dynamic Name) -->
                <div id="card-coordinator" class="guidance-card coordinator-card">
                    <h3><span class="icon">üìç</span> Kontakta din FoU-koordinator</h3>
                    <p>F√∂r f√∂rankring, lokala mallar och godk√§nnande av verksamhetschef √§r detta din f√∂rsta kontakt:</p>
                    <span id="coord-display-name" class="coord-name">Namn Namnsson</span>
                    <p><em>FoU-koordinator vid <span id="coord-display-clinic">Din Klinik</span></em></p>
                </div>

                <!-- NEW: REGION STOCKHOLM DATABASE -->
                <div id="card-database-slso" class="guidance-card alert-stop">
                    <h3><span class="icon">üìù</span> Obligatorisk Registrering (SLSO)</h3>
                    <p>Alla studier d√§r Region Stockholm (SLSO) √§r huvudman m√•ste registreras i <strong>Region Stockholms databas f√∂r kliniska studier</strong>.</p>
                    <p>Detta ers√§tter den gamla SLSO-databasen. Registreringen √∂kar transparensen och √§r ett krav.</p>
                    <a href="https://sllse.sharepoint.com/sites/KTeamsKarolinskasDatabasForKliniskaStudier/Lists/Registrerade%20Forskningsstudier%20Karolinska%20Universi/Standardvy%20Databas.aspx?viewid=7107bce2%2D9fa8%2D4a83%2Dae23%2D322fba1247f9" target="_blank">G√• till databasen (kr√§ver inlogg) &rarr;</a>
                </div>

                <!-- NEW: DIARIEF√ñRING -->
                <div id="card-diary-slso" class="guidance-card">
                    <h3><span class="icon">üóÇÔ∏è</span> Diarief√∂ring & Arkivering (SLSO)</h3>
                    <p>Alla studier ska ha ett diarienummer. Detta kan ofta skapas via Regionens databas (se ovan).</p>
                    <ul>
                        <li><strong>Diarief√∂ring:</strong> registrator.slso@regionstockholm.se</li>
                        <li><strong>Arkivering/Gallring:</strong> arkivarie.slso@regionstockholm.se</li>
                    </ul>
                    <p><em>Kontakta alltid registrator n√§r studien startar f√∂r att f√• ett √§rendenummer.</em></p>
                </div>

                <!-- 2. CLINICUM CARD -->
                <div id="card-clinicum" class="guidance-card">
                    <h3><span class="icon">üîç</span> Vetenskapligt metodst√∂d</h3>
                    <p>CPF tillhandah√•ller inte statistiskt st√∂d. V√§nd dig till <strong>Clinicum</strong> f√∂r kostnadsfri r√•dgivning.</p>
                    <a href="https://medarbetare.ki.se/forskarstod/klinisk-forskning/clinicum" target="_blank">Boka tid hos Clinicum &rarr;</a>
                </div>

                <!-- 3. DATA STORAGE CARDS -->
                <div id="card-storage-slso" class="guidance-card">
                    <h3><span class="icon">üîí</span> Best√§llning av N-yta (SLSO)</h3>
                    <p>F√∂r s√§ker lagring d√§r Region Stockholm √§r huvudman. Kr√§ver e-tj√§nstekort.</p>
                    <a href="https://tellus.regionstockholm.se/sp?id=sc_cat_item&sys_id=3ca8372e344f9b40fe7d41a570f170a0" target="_blank">G√• till Tellus best√§llning &rarr;</a>
                </div>

                <div id="card-storage-ki" class="guidance-card">
                    <h3><span class="icon">üìÅ</span> Projektmapp p√• KI</h3>
                    <p>F√∂r lagring p√• KI:s servrar. Best√§lls centralt via IT.</p>
                    <a href="https://medarbetare.ki.se/stod-och-verktyg/it-och-telefoni/lagra-och-dela-filer" target="_blank">Best√§ll via Medarbetarportalen &rarr;</a>
                </div>

                <!-- 4. DATA SYSTEMS -->
                <div id="card-systems" class="guidance-card">
                    <h3><span class="icon">üíª</span> System & Verktyg</h3>
                    <ul>
                        <li><strong>ELN (Loggbok):</strong> <a href="https://www.psykiatriforskning.se/forskning/for-dig-som-forskar/dokumentation-eln/" target="_blank">L√§s manualen h√§r</a></li>
                        <li><strong>REDCap (KI):</strong> <a href="https://medarbetare.ki.se/forskarstod/hantera-forskningsdata/skapa-samla-in-och-lagra-forskningsdata/redcap/tillgang-till-redcap" target="_blank">Ans√∂k om tillg√•ng (KI)</a></li>
                        <li><strong>REDCap (Regionen):</strong> <a href="https://www.karolinska.se/forskning-och-utbildning/forskning/stodenheter-for-klinisk-forskning/redcap---datainsamling-i-kliniska-studier/" target="_blank">St√∂d f√∂r kliniska studier</a></li>
                        <li><strong>Transkribering:</strong> Anv√§nd verktyget <em>Whisper</em> (lokal installation).</li>
                    </ul>
                </div>

                <!-- 5. JURIDIK / REGISTRY -->
                <div id="card-legal-slso" class="guidance-card">
                    <h3><span class="icon">üè•</span> Juridik & Uttag (SLSO)</h3>
                    <ul>
                        <li><strong>Menpr√∂vning/Uttag:</strong> fouu.slso@regionstockholm.se</li>
                        <li><strong>GDPR/Avtal:</strong> gdpr.slso@regionstockholm.se</li>
                        <li><strong>Mallar:</strong> Finns hos din FoU-koordinator (se ovan).</li>
                    </ul>
                </div>

                <div id="card-legal-ki" class="guidance-card">
                    <h3><span class="icon">üéì</span> Juridik & Avtal (KI)</h3>
                    <p>Kontakta juristerna p√• avtalsenheten.</p>
                    <a href="mailto:avtal@ki.se">avtal@ki.se</a>
                </div>

                <!-- 6. ETIK -->
                <div id="card-etik" class="guidance-card">
                    <h3><span class="icon">‚öñÔ∏è</span> Etikpr√∂vning</h3>
                    <p>Alla kliniska studier m√•ste ha godk√§nnande fr√•n Etikpr√∂vningsmyndigheten (EPM). Information om hur ans√∂kan g√•r till hittar du hos EPM.</p>
                    <p><a href="https://etikprovningsmyndigheten.se/for-forskare/sa-gar-det-till/" target="_blank">Etikpr√∂vning ‚Äì s√• g√•r det till &rarr;</a></p>
                    <hr style="border: 0; border-top: 1px solid #eee; margin: 10px 0;">
                    <p><strong>Beh√∂ver du hj√§lp med f√∂rhandsgranskning?</strong><br>
                    Vi p√• CPF Support hj√§lper dig g√§rna att granska din ans√∂kan innan du skickar den till EPM.</p>
                    <p>1. Skriv ut ans√∂kan som PDF fr√•n Ethix.<br>
                       2. Mejla den till oss.</p>
                    <a href="mailto:cpfsupport@cns.ki.se">cpfsupport@cns.ki.se</a>
                </div>
                
                 <!-- 7. RDO -->
                <div id="card-rdo" class="guidance-card">
                    <h3><span class="icon">üíæ</span> RDO (Data Office)</h3>
                    <p>F√∂r granskning av Datahanteringsplan (DMP) och generella datafr√•gor.</p>
                    <a href="mailto:rdo@ki.se">rdo@ki.se</a>
                </div>

                <span class="reset-link" onclick="location.reload()">B√∂rja om</span>
            </div>
        </div>

    </div>
</div>

<script>
    /* --- DATA & LOGIC --- */

    // Databas √∂ver koordinatorer (Uppdaterad fr√•n bild)
    const coordinators = {
        "BCS": "Sara Wallhed Finn",
        "BUP": "Ulf Jonsson",
        "NSP": "Mikael Tiger",
        "PNV": "Marc Guitart-Masip",
        "PSV": "Max Sannemalm",
        "PSS": "Anna Bj√∂rdhal",
        "SCA": "Anne-Charlotte Wiberg",
        "Ratts": "V√§nligen kontakta klinikledningen", // Fallback om ej i listan
        "Annat": "din lokala klinikledning"
    };
    
    // Kliniknamn f√∂r visning
    const clinicNames = {
        "BCS": "Beroendecentrum Stockholm",
        "BUP": "Barn- och ungdomspsykiatri",
        "NSP": "Norra Stockholms psykiatri",
        "PNV": "Psykiatri Nordv√§st",
        "PSV": "Psykiatri Sydv√§st",
        "PSS": "Psykiatri S√∂dra Stockholm",
        "SCA": "Stockholms centrum f√∂r √§tst√∂rningar",
        "Annat": "din klinik"
    };

    function goToStep(stepNumber) {
        // Validation Step 1
        if (stepNumber === 2) {
            const clinic = document.getElementById("clinic").value;
            if (!clinic) {
                alert("V√§nligen v√§lj en klinik i listan.");
                return;
            }
        }

        // Switch visible step
        document.querySelectorAll(".step").forEach(el => el.classList.remove("active"));
        document.getElementById("step" + stepNumber).classList.add("active");

        // Styling for radio options (selection highlight)
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.parentElement.parentElement.classList.remove('selected');
            if(radio.checked) {
                radio.parentElement.parentElement.classList.add('selected');
            }
        });
    }

    // Add click listeners to radios for styling
    document.querySelectorAll('.radio-option').forEach(option => {
        option.addEventListener('click', function() {
            // Find the radio inside and check it
            const radio = this.querySelector('input[type="radio"]');
            radio.checked = true;
            
            // Update visual state
            document.querySelectorAll('.radio-option').forEach(el => el.classList.remove('selected'));
            this.classList.add('selected');
            
            // If in Step 3, trigger result immediately
            if(radio.name === "category") {
                showResult();
            }
        });
    });


    function showResult() {
        // 1. Get User Inputs
        const clinicCode = document.getElementById("clinic").value;
        const huvudman = document.querySelector('input[name="huvudman"]:checked')?.value;
        const category = document.querySelector('input[name="category"]:checked')?.value;

        if (!clinicCode || !huvudman || !category) return; // Wait until all chosen

        // 2. Prepare Display Area
        const resultsArea = document.getElementById("results-area");
        resultsArea.style.display = "block";
        resultsArea.scrollIntoView({ behavior: 'smooth' });

        // Hide all cards first
        document.querySelectorAll(".guidance-card").forEach(el => el.classList.remove("visible"));

        // 3. LOGIC ENGINE

        // --- Coordinator Logic (Always relevant for local anchoring) ---
        // If category is Starta, Juridik, or generally needing local help
        if (category === "Starta" || category === "Juridik" || category === "Etik") {
            const coordName = coordinators[clinicCode] || "din lokala samordnare";
            const clinicName = clinicNames[clinicCode] || "din klinik";
            
            document.getElementById("coord-display-name").innerText = coordName;
            document.getElementById("coord-display-clinic").innerText = clinicName;
            
            document.getElementById("card-coordinator").classList.add("visible");
        }

        // --- SPECIAL: Region Stockholm Database & Diary ---
        // Shows if SLSO is involved AND user is starting/legal
        if ((category === "Starta" || category === "Juridik") && (huvudman === "SLSO" || huvudman === "Bada")) {
            document.getElementById("card-database-slso").classList.add("visible");
            document.getElementById("card-diary-slso").classList.add("visible");
        }

        // --- Category Specifics ---

        if (category === "Statistik") {
            document.getElementById("card-clinicum").classList.add("visible");
        }

        if (category === "Data") {
            // Show Storage based on Huvudman
            if (huvudman === "SLSO" || huvudman === "Bada") {
                document.getElementById("card-storage-slso").classList.add("visible");
            }
            if (huvudman === "KI" || huvudman === "Bada") {
                document.getElementById("card-storage-ki").classList.add("visible");
            }
            // Show Systems & RDO
            document.getElementById("card-systems").classList.add("visible");
            document.getElementById("card-rdo").classList.add("visible");
        }

        if (category === "Juridik") {
            // Show Legal based on Huvudman
            if (huvudman === "SLSO" || huvudman === "Bada") {
                document.getElementById("card-legal-slso").classList.add("visible");
            }
            if (huvudman === "KI" || huvudman === "Bada") {
                document.getElementById("card-legal-ki").classList.add("visible");
            }
        }

        if (category === "Etik") {
            document.getElementById("card-etik").classList.add("visible");
        }
    }

</script>

</body>
</html>